---
sidebar: sidebar
permalink: backup/anf-cba-overview-of-installation-and-configuration-steps.html
keywords: bluexp, hana host, backup user, hana system database
summary: "This section describes the installation and configuration of all components of this solution."
---
= Overview of installation and configuration steps
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./../media/

//
// This file was created with NDAC Version 2.0 (August 17, 2020)
//
// 2023-03-16 10:24:27.240164
//


[.lead]
The required installation and configuration steps can be split in three areas.

* Installation and configuration of NetApp BlueXP components.
+
Must be performed once during the initial setup of the data protection solution.

* Preparation steps on HANA host and database.
+
Must be performed for each HANA database, which should be protected by CBA.

* Configuration steps in Cloud Backup for Applications.
+
Must be performed for each HANA database, which should be protected by CBA.

== Installation and configuration of NetApp BlueXP components

The installation and configuration of the NetApp BlueXP components are described in https://docs.netapp.com/us-en/cloud-manager-backup-restore/concept-protect-cloud-app-data-to-cloud.html[Protect your cloud native applications data | NetApp Documentation^].

. Sign up to BlueXP and set up a NetApp account.
. Deploy the BlueXP connector in your Azure vNet.
. Create the working environment for Azure NetApp Files in BlueXP.

image:anf-cba-image5.png["This image depicts the architecture of the solution as described in this section."]

== Preparation steps on HANA host and database

. JAVA 11 installation on HANA host. Either Java 11 (64-bit) Oracle Java or OpenJDK must be installed on the HANA database hosts.
. Deploy the CBA HANA plug-in on the HANA host as described in link:https://docs.netapp.com/us-en/cloud-manager-backup-restore/task-deploy-snapcenter-plugin-for-sap-hana.html["Deploy Cloud Backup for Applications Plug-in for SAP HANA | NetApp Documentation"].
. Create a backup user at the HANA system database as is described in next chapter.

== Configuration steps in Cloud Backup for Applications

. Add a HANA host to Cloud Backup for Applications.
.. HANA user store key configuration.
.. Storage footprint configuration.
. Create and assign backup policies for the HANA system.
.. Snapshot-based backup operations.
.. File-based backup operations.
. Configure non-data volume backup operations.
.. Storage footprint configuration.
.. Create and assign a backup policy.
. Configure global non-data volume backup operations.
.. System details configuration.
.. Storage footprint configuration.
.. Create and assign a backup policy.

The next chapters describe the configuration steps for Cloud Backup for Applications in detail.

== Create backup user at HANA system database

NetApp recommends configuring a dedicated database user in the HANA database to run the backup operations with CBA. In the second step, an SAP HANA user store key is configured for this backup user, and this user store key is used in the configuration of the Cloud Backup for Applications SAP HANA plug-in. The following figure shows the SAP HANA Studio through which you can create the backup user.

The required privileges are as follows:

* backup admin
* catalog read
* database backup admin
* database recovery operator

For an SAP HANA MDC system, you must create the user in the system database because all backup commands for the system and the tenant databases are executed by using the system database.

image:anf-cba-image10.png["This screenshot shows where to create a user in the system database."]

== Add HANA system to Cloud Backup for Application

. Within BlueXP, select *Protection* > *Backup and recovery* > *Applications.*
+
image:anf-cba-image11.png["This screenshot shows the blueXP Canvas with the correct path to Applications displayed."]

. The next screenshots show the workflow when adding the first HANA system. If there are already systems added to Cloud Backup for Applications, the initial screen is a dashboard view with an *Add System* button to add an additional HANA system. In that, case step 5 is the first step.  Click *Discover Application*.
+
image:anf-cba-image12.png["This screenshot shows the workflow when adding the first HANA system. "]

. Click *Cloud Native*.
+
image:anf-cba-image13.png["This screenshot depicts the Hybrid vs Cloud Native selection page."]

. Click *SAP HANA*.
+
image:anf-cba-image14.png["This screenshot depicts the Hybrid vs Cloud Native selection page."]

. In the System Details screen, select the system type: HANA single-container or multitenant database container. Provide the SID of the HANA system and enter free text as a system name.
+
The following screenshots show the configuration of an SAP HANA system PR1.
+
image:anf-cba-image15.png["This screenshot shows the configuration of an SAP HANA system PR1."]

. Click *Add Plug-in host* to add the HANA database host. Typically, a host name is used. IP addresses also work. Port `8145` is the default port of the HANA plug-in that was installed on the HANA database host. If no changes have been made during the plug-in installation, the default port is valid.
+
[NOTE]
For a HANA multiple-host system, you only need to add the host where the system database is running.
+
image:anf-cba-image16.png["This screenshot shows the Add-Plug-in Host selection screen."]

. To add a HANA database user store key, click *Add User Store Key*.
+
Enter the information for configuring the user store key for the HANA database. You can provide any name as the key name. The system details include the IP address and the port to communicate with the system database using the hdbsql client. For an SAP HANA MDC system, port `3<instanceNo>13` is the standard port for SQL access to the system database.
+
You must provide the username and password for the database user in the system database that was previously configured. Cloud Backup for Applications automatically creates a user store key by using this information and uses the key to communicate with the HANA database.
+
image:anf-cba-image17.png["This screenshot shows the Add User Store Key selection screen."]

. On the HANA host, you can check if the key works by executing the following commands:
+
....
pr1adm@vm-pr1:/usr/sap/PR1/HDB01> hdbuserstore list
DATA FILE       : /usr/sap/PR1/pr1adm/.hdb/vm-pr1/SSFS_HDB.DAT
KEY FILE        : /usr/sap/PR1/pr1adm/.hdb/vm-pr1/SSFS_HDB.KEY
KEY PR1KEY
  ENV : 10.0.1.20:30113
  USER: SNAPSHOT
KEY PR1SAPDBCTRL
  ENV : vm-pr1:30113
  USER: SAPDBCTRL
pr1adm@vm-pr1:/usr/sap/PR1/HDB01> hdbsql -U PR1KEY
Welcome to the SAP HANA Database interactive terminal.
Type:  \h for help with commands
       \q to quit
hdbsql SYSTEMDB=>
....

. Click *Next* to finish the System Details configuration.
+
image:anf-cba-image18.png["This screenshot shows the System Details screen."]

. Click *Add Storage* to configure the storage footprint of the HANA database.
+
image:anf-cba-image19.png["This screenshot shows the Add Storage Button on the Storage Footprint screen."]

. Enter the information for the storage volumes of the HANA system.
. Select the working environment and the NetApp account that is used for the ANF volumes of the HANA system. Select the data volume of your HANA system. In our example, this is `PR1_data_mnt00001`.
+
[NOTE]
For an SAP HANA multiple-host system, you must select the data volumes of all HANA hosts belonging to the system.
+
image:anf-cba-image20.png["This screenshot shows the Add Storage Footprint selection screen."]

. Click *Next* to add the storage footprint.
+
image:anf-cba-image21.png["This screenshot shows how to add the storage footprint."]

. Review the configuration and click *Add System*.
+
image:anf-cba-image22.png["This screenshot shows how to add the storage system."]
+
image:anf-cba-image23.png["This screenshot shows the result."]

The HANA system is now added to Cloud Backup for Applications. As a next step, you must configure backup operations.

image:anf-cba-image24.png["This screenshot shows where to configure backup operations."]
