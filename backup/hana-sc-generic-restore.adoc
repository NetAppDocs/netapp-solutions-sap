---
sidebar: sidebar
permalink: backup/hana-sc-generic-restore.html
keywords: SAP HANA, SnapCenter, backup and recovery, Azure NetApp Files, FSx for NetApp ONTAP
summary:
---

= Restore and recovery with SnapCenter

:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ../media/

SnapCenter supports the following restore and recovery operations.

* SAP HANA MDC systems with a single tenant
** End-to-end automated restore and recovery
** End-to-end automated restore and manual recovery (selectable)
* SAP HANA MDC systems with multiple tenants
** End-to-end automated restore, recovery needs to be done manually
* Restore of a single tenant
** End-to-end automated restore, recovery needs to be done manually

NOTE: Automated recovery is only supported when the HANA plug-in is deployed on the HANA database host and the HANA system got auto discovered by SnapCenter. With a central plug-in host configuration, recovery needs to be done manually after the restore operation with SnapCenter.

NOTE: Restore from primary ANF volume is supported. A restore form ANF backup is not yet supported. An in-place restore or a restore to a new volume from an ANF backup must be done manually using the Azure portal or CLI.

== Automated restore and recovery for SAP HANA MDC systems with a single tenant

A restore operation is initiated by selecting a Snapshot backup in the resource topology view and by clicking on Restore.

image:hana-sc-generic-image-098.png[width=601,height=294]

For HANA systems using NFS on ANF, FSx for ONTAP or ONTAP storage systems you can select complete restore with or without a volume revert operation for primary volume Snapshots.

* Complete resource without volume revert uses Single File SnapRestore (SFSR) to restore all files of the database.
* Complete resource with volume revert uses a volume based restore operation (VBSR) to revert the complete volume back to the state of the selected Snapshot.

NOTE: Volume revert can't be used if you need to restore to a Snapshot which is older than the active SnapVault or SnapMirror replication Snapshot.

NOTE: A volume revert operation will delete all Snapshot backups which are newer than the selected Snapshot for the revert operation.

NOTE: A restore with SFSR is nearly as fast as a volume revert operation but blocks any Snapshot operation until the background process has finished the meta data operations.

image:hana-sc-generic-image-099.png[width=300]

For HANA systems on bare metal hosts using FC SAN, a volume revert (VBSR) is not supported, instead SFSR is always used for the restore operation. For HANA systems running on VMware with VMFS a clone, mount, copy operation will be used.

image:hana-sc-generic-image-100.png[width=345,height=325]

For a restore from a secondary backup you need to select the archive location.

image:hana-sc-generic-image-101.png[width=345,height=323]

With the recovery scope you can select a 'to most recent state', 'point in time' or a save point recovery without using log backups. If you select no recovery, SnapCenter only executes the restore operation and the recovery needs to be done manually as described in chapter link:hana-sc-generic-restore.html#manual-recovery-with-hana-studio["Manual recovery with HANA Studio"].

NOTE: SnapCenter uses the paths configured in SAP HANA for log backup and catalog backup locations. If you have tiered backups to an additional location, you can add these additional paths.

image:hana-sc-generic-image-102.png[width=346,height=324]

Optionally you can add pre and post restore scripts.

image:hana-sc-generic-image-103.png[width=348,height=326]

image:hana-sc-generic-image-104.png[width=359,height=335]

When clicking on Finish in the summary screen, the restore and recovery operation is started.

image:hana-sc-generic-image-105.png[width=361,height=336]

The restore and recovery workflow can be devided in three main sections.

* Shutdown of the HANA system
* Restore operation
** Filesystem specific preparations, e.g. unmount operation
** Snapshot restore operation
** Filesystem specific post operations, e.g. mount operation
* HANA recovery
** System database recovery
** Tenant database recovery

image:hana-sc-generic-image-106.png[width=357,height=439]

== Manual recovery with HANA Studio

To restore and recover an SAP HANA MDC system with a single or with multiple tenants using SAP HANA Studio and SnapCenter, complete the following steps:

[arabic]
. Prepare the restore and recovery process with SAP HANA Studio:
[loweralpha]
.. Select Recover System Database and confirm shutdown of the SAP HANA system.
.. Select the recovery type and provide the backup catalog location.
.. The list of data backups is shown. Select Backup to see the external backup ID.
. Perform the restore process with SnapCenter:
[loweralpha]
.. In the topology view of the resource, select Local Copies to restore from primary storage or Vault Copies if you want to restore from an secondary backup storage.
.. Select the SnapCenter backup that matches the external backup ID or comment field from SAP HANA Studio.
.. Start the restore process.
. Run the recovery process for the system database with SAP HANA Studio:
[loweralpha]
.. Click Refresh from the backup list and select the available backup for recovery (indicated with a green icon).
.. Start the recovery process. After the recovery process is finished, the system database is started.
. Run the recovery process for the tenant database with SAP HANA Studio:
[loweralpha]
.. Select Recover Tenant Database and select the tenant to be recovered.
.. Select the recovery type and the log backup location.
.. A list of data backups displays. Because the data volume has already been restored, the tenant backup is indicated as available (in green).
.. Select this backup and start the recovery process. After the recovery process is finished, the tenant database is started automatically.
. For a HANA system with multiple tenants repeat step 4 for each tenant.

NOTE: A manual recovery with SAP HANA Cockpit is done with the same steps.

The following section describes the steps of the restore and recovery operations of an SAP HANA MDC system with a single tenant.

In HANA Studio select Backup and Recovery and Recover System Database.

image:hana-sc-generic-image-107.png[width=450,height=368]

Confirm shutdown operation; only required if the HANA system is still running.

image:hana-sc-generic-image-108.png[width=349,height=83]

Select recovery operation. In our example we want to recover to the most recent state.

image:hana-sc-generic-image-109.png[width=345,height=359]

Provide backup catalog location.

image:hana-sc-generic-image-110.png[width=343,height=356]

HANA Studio lists the most recent backups stored in the HANA backup catalog.

A list of available backups is shown based on the content of the backup catalog. Choose the required backup and note the external backup ID: in our example, the most recent backup.

image:hana-sc-generic-image-111.png[width=391,height=283]

From the SnapCenter GUI, select the resource topology view and select the backup that should be restored, in our example, the most recent primary backup. Click the Restore icon to start the restore.

image:hana-sc-generic-image-112.png[width=601,height=294]

The SnapCenter restore wizard starts. Select the restore type Complete Resource and Volume revert to use a volume-based restore.

image:hana-sc-generic-image-113.png[width=346,height=325]

Select 'No recovery' to exclude the recovery operations from the SnapCenter workflow.

image:hana-sc-generic-image-114.png[width=358,height=336]

Click on Finish to start the restore operation.

image:hana-sc-generic-image-115.png[width=361,height=339]

SnapCenter is now executing the restore operation.

* Filesystem specifc preparations, e.g. unmount operation
* Snapshot restore operation
* Filesystem specifc post operations, e.g. mount operation

image:hana-sc-generic-image-116.png[width=322,height=398]

When the Snapshot got restored by SnapCenter a snapshot_databackup_0_1 file is available in the system and tenant database subdirectory of the HANA data volume. This file got created by the HANA database during the HANA database Snapshot creation. HANA deletes the file when the backup operation is finished, so that the files are only visible within the Snapshot backup. These files are required for any recovery operation. After the recovery the files get deleted by the HANA database.

....

hana-1:~ # cd /hana/data/SS1/mnt00001/
hana-1:/hana/data/SS1/mnt00001 # ls -al *
-rw-r--r-- 1 ss1adm sapsys 16 Aug 26 06:00 nameserver.lck
hdb00001:
total 4992236
drwxr-x--- 2 ss1adm sapsys 4096 Aug 26 06:00 .
drwxr-x--- 5 ss1adm sapsys 4096 Aug 26 06:00 ..
-rw-r----- 1 ss1adm sapsys 0 Nov 3 2020 __DO_NOT_TOUCH_FILES_IN_THIS_DIRECTORY__
-rw-r----- 1 ss1adm sapsys 5100273664 Aug 26 06:00 datavolume_0000.dat
-rw-r----- 1 ss1adm sapsys 36 Aug 25 10:30 landscape.id
-rw-r----- 1 ss1adm sapsys 163840 Aug 26 06:00 snapshot_databackup_0_1
hdb00002.00003:
total 201420
drwxr-xr-- 2 ss1adm sapsys 4096 Nov 3 2020 .
drwxr-x--- 5 ss1adm sapsys 4096 Aug 26 06:00 ..
-rw-r--r-- 1 ss1adm sapsys 0 Nov 3 2020 __DO_NOT_TOUCH_FILES_IN_THIS_DIRECTORY__
-rw-r--r-- 1 ss1adm sapsys 335544320 Aug 26 06:00 datavolume_0000.dat
hdb00003.00003:
total 4803140
drwxr-xr-- 2 ss1adm sapsys 4096 Aug 26 06:00 .
drwxr-x--- 5 ss1adm sapsys 4096 Aug 26 06:00 ..
-rw-r--r-- 1 ss1adm sapsys 0 Nov 3 2020 __DO_NOT_TOUCH_FILES_IN_THIS_DIRECTORY__
-rw-r--r-- 1 ss1adm sapsys 4898947072 Aug 26 06:00 datavolume_0000.dat
-rw-r----- 1 ss1adm sapsys 159744 Aug 26 06:00 snapshot_databackup_0_1
hana-1:/hana/data/SS1/mnt00001 #

....

Go to SAP HANA Studio and click Refresh to update the list of available backups. The backup that was restored with SnapCenter is now shown with a green icon in the list of backups. Select the backup and click Next.

image:hana-sc-generic-image-117.png[width=400,height=290]

Provide the location of the log backups. Click Next.

NOTE: SAP HANA Studio uses the paths configured in SAP HANA for log backup and catalog backup locations. If you have tiered backups to an additional location, you can add these additional paths.

image:hana-sc-generic-image-118.png[width=465,height=296]

Select other settings as required. Make sure Use Delta Backups is not selected. Click Next.

image:hana-sc-generic-image-119.png[width=466,height=296]

Review the recovery settings and click Finish.

By clicking on show SQL statement, HANA Studio shows the SQL command which is executed for the recovery operation.

image:hana-sc-generic-image-120.png[width=464,height=295]

The recovery process starts. Wait until the recovery of the system database is completed.

image:hana-sc-generic-image-121.png[width=376,height=239]

In SAP HANA Studio, select the entry for the system database and start Backup Recovery - Recover Tenant Database.

image:hana-sc-generic-image-122.png[width=476,height=315]

Select the tenant to recover and click Next.

image:hana-sc-generic-image-123.png[width=342,height=355]

Specify the recovery type and click Next.

image:hana-sc-generic-image-124.png[width=343,height=356]

Confirm the backup catalog location and click Next.

image:hana-sc-generic-image-125.png[width=342,height=355]

Confirm that the shutdown of the tenant database.

image:hana-sc-generic-image-126.png[width=348,height=85]

Because the restore of the data volume has been done before the recovery of the system database, the tenant backup is immediately available. Select the backup highlighted in green and click Next.

image:hana-sc-generic-image-127.png[width=433,height=349]

Provide the location of the log backups. Click Next.

NOTE: SAP HANA Studio uses the paths configured in SAP HANA for log backup and catalog backup locations. If you have tiered backups to an additional location, you can add these additional paths.

image:hana-sc-generic-image-128.png[width=384,height=310]

Select other settings as required. Make sure Use Delta Backups is not selected. Click Next.

image:hana-sc-generic-image-129.png[width=384,height=310]

Review the recovery settings and click Finish.

By clicking on show SQL statement, HANA Studio shows the SQL command which is executed for the recovery operation.

image:hana-sc-generic-image-130.png[width=380,height=307]

Wait until the recovery has finished and the tenant database is started.

image:hana-sc-generic-image-131.png[width=378,height=305]

When the tenant recovery is finished the SAP HANA system is up and running.

NOTE: For an SAP HANA MDC system with multiple tenants, you must repeat the tenant recovery for each tenant.

== Manual recovery with SQL commands

You can also use SQL statements for the recovery of the HANA system.

First you need to recover the system database.
....

HDBSettings.sh recoverSys.py --command="RECOVER DATABASE UNTIL TIMESTAMP '2026-08-26 10:55:49' USING CATALOG PATH ('mnt/log-backup/SYSTEMDB') USING LOG PATH ('mnt/log-backup/SYSTEMDB') USING SNAPSHOT"
....

As a second step you need to connect to the system database and start the recovery of the tenant database(s). In our example the tenant database is SS1.
....

hdbsql SYSTEMDB=> RECOVER DATABASE FOR SS1 UNTIL TIMESTAMP '2026-08-26 10:55:49' USING CATALOG PATH ('mnt/log-backup/DB_SS1') USING LOG PATH ('mnt/log-backup/DB_SS1') USING SNAPSHOT
....
== Single tenant restore and recovery

A single tenant restore and recovery operation with SnapCenter is very similar to the workflow described in the previous chapter link:hana-sc-generic-restore.html#manual-recovery-with-hana-studio["Manual recovery with HANA Studio"].

To restore and recover an SAP HANA MDC single-tenant system using SAP HANA Studio and SnapCenter, complete the following steps:

[arabic]
. Prepare the restore and recovery process with SAP HANA Studio:
[loweralpha]
.. Select Recover Tenant Database and confirm shutdown of the tenant database.
.. Select the recovery type and provide the backup catalog location.
.. The list of data backups is shown. Select Backup to see the external backup ID.
. Perform the restore process with SnapCenter:
[loweralpha]
.. In the topology view of the resource, select Local Copies to restore from primary storage or Vault Copies if you want to restore from an secondary backup storage.
.. Select the SnapCenter backup that matches the external backup ID or comment field from SAP HANA Studio.
.. Start the restore process of the tenant.
. Run the recovery process for the tenant database with SAP HANA Studio:
[loweralpha]
.. Click Refresh from the backup list and select the available backup for recovery (indicated with a green icon).
.. Start the recovery process. After the recovery process is finished, the tenant database is started.

== Restore of non-data volumes

A restore operation for a non-data volume is started by selecting a Snapshot backup in the topology view of the non-data volume resource and by clicking on Restore.

image:hana-sc-generic-image-132.png[width=601,height=294]

For non-data volumes with NFS a complete resource (VBSR) or a file level (SFSR) restore operation can be selected. For the file level restore either all or individual files can be defined for the restore operation.

image:hana-sc-generic-image-133.png[width=369,height=344]

